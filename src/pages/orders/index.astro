---
import Layout from "@/layouts/Layout.astro";
import { orders } from "@/data/store";

export const prerender = false;

const { user } = Astro.locals;

if (!user) {
  return Astro.redirect("/auth/sign-in");
}

const statusColors: Record<string, string> = {
  pending: "bg-yellow-500/10 text-yellow-600",
  processing: "bg-blue-500/10 text-blue-600",
  shipped: "bg-purple-500/10 text-purple-600",
  delivered: "bg-green-500/10 text-green-600",
  cancelled: "bg-red-500/10 text-red-600",
};

function formatDate(dateString: string) {
  return new Date(dateString).toLocaleDateString("en-US", {
    year: "numeric",
    month: "short",
    day: "numeric",
  });
}
---

<Layout title="Orders - usestore">
  <div class="container mx-auto px-4 py-12 md:py-16">
    <div class="max-w-4xl mx-auto">
      <h1 class="text-2xl font-medium">Your Orders</h1>
      <p class="text-sm text-muted-foreground mt-2 mb-8">{orders.length} {orders.length === 1 ? 'order' : 'orders'}</p>

      {orders.length > 0 ? (
        <div class="border-t">
          {orders.map((order) => (
            <a href={`/orders/${order.id}`} class="block py-6 border-b hover:bg-muted/30 transition-colors -mx-4 px-4">
              <div class="flex items-start justify-between gap-4 mb-4">
                <div class="min-w-0">
                  <div class="flex flex-wrap items-center gap-x-3 gap-y-1">
                    <span class="font-medium">{order.id}</span>
                    <span class={`text-xs px-2 py-0.5 capitalize ${statusColors[order.status]}`}>
                      {order.status}
                    </span>
                  </div>
                  <p class="text-sm text-muted-foreground mt-1">
                    {formatDate(order.date)} Â· {order.items.length} {order.items.length === 1 ? "item" : "items"}
                  </p>
                </div>
                <div class="text-right shrink-0">
                  <p class="font-medium">${order.total.toFixed(2)}</p>
                </div>
              </div>
              <div class="flex gap-3">
                {order.items.slice(0, 5).map((item) => (
                  <div class="w-14 h-[72px] shrink-0 bg-muted flex items-center justify-center text-muted-foreground/30">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                      <rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect>
                      <circle cx="9" cy="9" r="2"></circle>
                      <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path>
                    </svg>
                  </div>
                ))}
                {order.items.length > 5 && (
                  <div class="w-14 h-[72px] shrink-0 bg-muted flex items-center justify-center text-xs text-muted-foreground">
                    +{order.items.length - 5}
                  </div>
                )}
              </div>
            </a>
          ))}
        </div>
      ) : (
        <div class="text-center py-16 max-w-sm mx-auto">
          <div class="w-16 h-16 mx-auto mb-6 bg-muted flex items-center justify-center text-muted-foreground">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M16 16h6"></path>
              <path d="M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14"></path>
              <path d="m7.5 4.27 9 5.15"></path>
              <polyline points="3.29 7 12 12 20.71 7"></polyline>
              <line x1="12" x2="12" y1="22" y2="12"></line>
            </svg>
          </div>
          <h2 class="text-lg font-medium">No orders yet</h2>
          <p class="text-sm text-muted-foreground mt-2 mb-8">When you place an order, it will appear here.</p>
          <a href="/products" class="inline-block py-3 px-8 bg-primary text-primary-foreground text-sm font-medium hover:bg-primary/90">
            Start Shopping
          </a>
        </div>
      )}
    </div>
  </div>
</Layout>
